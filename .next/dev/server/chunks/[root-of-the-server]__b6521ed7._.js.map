{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/LENOVO/Documents/WEB%20DE%20cotizaciones/src/lib/firebase-admin.js"],"sourcesContent":["import admin from 'firebase-admin';\r\nimport dotenv from 'dotenv';\r\nimport { fileURLToPath } from 'url';\r\nimport { dirname, join } from 'path';\r\nimport fs from 'fs';\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = dirname(__filename);\r\nconst rootDir = join(__dirname, '../../');\r\nconst envPath = join(rootDir, '.env');\r\n\r\nconsole.log('--- FIREBASE DEBUG ---');\r\nconsole.log('Project Root:', rootDir);\r\nconsole.log('Dotenv Path:', envPath);\r\nif (fs.existsSync(envPath)) {\r\n    console.log('.env file exists at this path.');\r\n    const result = dotenv.config({ path: envPath });\r\n    if (result.error) console.error('Dotenv Error:', result.error);\r\n    else console.log('Dotenv loaded successfully.');\r\n} else {\r\n    console.error('.env file DOES NOT exist at expected path.');\r\n}\r\nconsole.log('Project ID in process.env:', process.env.FIREBASE_PROJECT_ID || 'MISSING');\r\nconsole.log('----------------------');\r\n\r\nlet firestore = null;\r\nlet storage = null;\r\n\r\n// Initialize Firebase Admin\r\nif (!admin.apps.length) {\r\n    try {\r\n        if (process.env.FIREBASE_PROJECT_ID) {\r\n            const projectId = process.env.FIREBASE_PROJECT_ID.trim().replace(/^[\"']|[\"']$/g, '');\r\n            const clientEmail = process.env.FIREBASE_CLIENT_EMAIL?.trim().replace(/^[\"']|[\"']$/g, '');\r\n\r\n            let privateKey = process.env.FIREBASE_PRIVATE_KEY || '';\r\n            privateKey = privateKey.trim().replace(/^[\"']|[\"']$/g, '').replace(/\\\\n/g, '\\n');\r\n\r\n            admin.initializeApp({\r\n                credential: admin.credential.cert({\r\n                    projectId,\r\n                    clientEmail,\r\n                    privateKey,\r\n                }),\r\n                storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET?.trim().replace(/^[\"']|[\"']$/g, '')\r\n            });\r\n            firestore = admin.firestore();\r\n            storage = admin.storage();\r\n            console.log('Firebase initialized successfully!');\r\n        } else {\r\n            console.warn('Firebase Admin SDK not initialized: Missing credentials.');\r\n        }\r\n    } catch (error) {\r\n        console.error('Firebase admin initialization error', error);\r\n    }\r\n}\r\n\r\nif (admin.apps.length > 0) {\r\n    firestore = admin.firestore();\r\n    storage = admin.storage();\r\n}\r\n\r\nexport { firestore, storage, admin };\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;AAEA,MAAM,aAAa,IAAA,gHAAa,EAAC,8BAAY,GAAG;AAChD,MAAM,YAAY,IAAA,4GAAO,EAAC;AAC1B,MAAM,UAAU,IAAA,yGAAI,EAAC,WAAW;AAChC,MAAM,UAAU,IAAA,yGAAI,EAAC,SAAS;AAE9B,QAAQ,GAAG,CAAC;AACZ,QAAQ,GAAG,CAAC,iBAAiB;AAC7B,QAAQ,GAAG,CAAC,gBAAgB;AAC5B,IAAI,wGAAE,CAAC,UAAU,CAAC,UAAU;IACxB,QAAQ,GAAG,CAAC;IACZ,MAAM,SAAS,kJAAM,CAAC,MAAM,CAAC;QAAE,MAAM;IAAQ;IAC7C,IAAI,OAAO,KAAK,EAAE,QAAQ,KAAK,CAAC,iBAAiB,OAAO,KAAK;SACxD,QAAQ,GAAG,CAAC;AACrB,OAAO;IACH,QAAQ,KAAK,CAAC;AAClB;AACA,QAAQ,GAAG,CAAC,8BAA8B,QAAQ,GAAG,CAAC,mBAAmB,IAAI;AAC7E,QAAQ,GAAG,CAAC;AAEZ,IAAI,YAAY;AAChB,IAAI,UAAU;AAEd,4BAA4B;AAC5B,IAAI,CAAC,8LAAK,CAAC,IAAI,CAAC,MAAM,EAAE;IACpB,IAAI;QACA,IAAI,QAAQ,GAAG,CAAC,mBAAmB,EAAE;YACjC,MAAM,YAAY,QAAQ,GAAG,CAAC,mBAAmB,CAAC,IAAI,GAAG,OAAO,CAAC,gBAAgB;YACjF,MAAM,cAAc,QAAQ,GAAG,CAAC,qBAAqB,EAAE,OAAO,QAAQ,gBAAgB;YAEtF,IAAI,aAAa,QAAQ,GAAG,CAAC,oBAAoB,IAAI;YACrD,aAAa,WAAW,IAAI,GAAG,OAAO,CAAC,gBAAgB,IAAI,OAAO,CAAC,QAAQ;YAE3E,8LAAK,CAAC,aAAa,CAAC;gBAChB,YAAY,8LAAK,CAAC,UAAU,CAAC,IAAI,CAAC;oBAC9B;oBACA;oBACA;gBACJ;gBACA,oFAAgE,OAAO,QAAQ,gBAAgB;YACnG;YACA,YAAY,8LAAK,CAAC,SAAS;YAC3B,UAAU,8LAAK,CAAC,OAAO;YACvB,QAAQ,GAAG,CAAC;QAChB,OAAO;YACH,QAAQ,IAAI,CAAC;QACjB;IACJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,uCAAuC;IACzD;AACJ;AAEA,IAAI,8LAAK,CAAC,IAAI,CAAC,MAAM,GAAG,GAAG;IACvB,YAAY,8LAAK,CAAC,SAAS;IAC3B,UAAU,8LAAK,CAAC,OAAO;AAC3B"}},
    {"offset": {"line": 141, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/LENOVO/Documents/WEB%20DE%20cotizaciones/src/app/api/users/route.js"],"sourcesContent":["import { firestore } from '@/lib/firebase-admin';\r\n\r\nexport async function POST(req) {\r\n    try {\r\n        const { uid, email, displayName, photoURL, firstName } = await req.json();\r\n\r\n        if (!uid || !email) {\r\n            return Response.json({ error: 'Missing required fields' }, { status: 400 });\r\n        }\r\n\r\n        const userRef = firestore.collection('users').doc(uid);\r\n\r\n        const userData = {\r\n            uid,\r\n            email,\r\n            displayName: displayName || '',\r\n            photoURL: photoURL || '',\r\n            firstName: firstName || displayName?.split(' ')[0] || 'Usuario',\r\n            lastActive: new Date().toISOString(),\r\n            updatedAt: new Date().toISOString()\r\n        };\r\n\r\n        // Check if user exists\r\n        const userDoc = await userRef.get();\r\n\r\n        if (userDoc.exists) {\r\n            // Update existing user\r\n            await userRef.update({\r\n                lastActive: userData.lastActive,\r\n                updatedAt: userData.updatedAt,\r\n                // Update profile info in case it changed\r\n                displayName: userData.displayName,\r\n                photoURL: userData.photoURL,\r\n                firstName: userData.firstName\r\n            });\r\n        } else {\r\n            // Create new user\r\n            await userRef.set({\r\n                ...userData,\r\n                createdAt: new Date().toISOString()\r\n            });\r\n        }\r\n\r\n        return Response.json({ success: true, user: userData });\r\n    } catch (error) {\r\n        console.error('User API Error:', error);\r\n        return Response.json({ error: 'Failed to save user data' }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function GET(req) {\r\n    try {\r\n        const snapshot = await firestore.collection('users').get();\r\n        const users = snapshot.docs.map(doc => ({\r\n            id: doc.id,\r\n            ...doc.data()\r\n        }));\r\n\r\n        return Response.json(users);\r\n    } catch (error) {\r\n        console.error('Users GET Error:', error);\r\n        return Response.json({ error: 'Failed to fetch users' }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,eAAe,KAAK,GAAG;IAC1B,IAAI;QACA,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,WAAW,EAAE,QAAQ,EAAE,SAAS,EAAE,GAAG,MAAM,IAAI,IAAI;QAEvE,IAAI,CAAC,OAAO,CAAC,OAAO;YAChB,OAAO,SAAS,IAAI,CAAC;gBAAE,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAC7E;QAEA,MAAM,UAAU,8JAAS,CAAC,UAAU,CAAC,SAAS,GAAG,CAAC;QAElD,MAAM,WAAW;YACb;YACA;YACA,aAAa,eAAe;YAC5B,UAAU,YAAY;YACtB,WAAW,aAAa,aAAa,MAAM,IAAI,CAAC,EAAE,IAAI;YACtD,YAAY,IAAI,OAAO,WAAW;YAClC,WAAW,IAAI,OAAO,WAAW;QACrC;QAEA,uBAAuB;QACvB,MAAM,UAAU,MAAM,QAAQ,GAAG;QAEjC,IAAI,QAAQ,MAAM,EAAE;YAChB,uBAAuB;YACvB,MAAM,QAAQ,MAAM,CAAC;gBACjB,YAAY,SAAS,UAAU;gBAC/B,WAAW,SAAS,SAAS;gBAC7B,yCAAyC;gBACzC,aAAa,SAAS,WAAW;gBACjC,UAAU,SAAS,QAAQ;gBAC3B,WAAW,SAAS,SAAS;YACjC;QACJ,OAAO;YACH,kBAAkB;YAClB,MAAM,QAAQ,GAAG,CAAC;gBACd,GAAG,QAAQ;gBACX,WAAW,IAAI,OAAO,WAAW;YACrC;QACJ;QAEA,OAAO,SAAS,IAAI,CAAC;YAAE,SAAS;YAAM,MAAM;QAAS;IACzD,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,SAAS,IAAI,CAAC;YAAE,OAAO;QAA2B,GAAG;YAAE,QAAQ;QAAI;IAC9E;AACJ;AAEO,eAAe,IAAI,GAAG;IACzB,IAAI;QACA,MAAM,WAAW,MAAM,8JAAS,CAAC,UAAU,CAAC,SAAS,GAAG;QACxD,MAAM,QAAQ,SAAS,IAAI,CAAC,GAAG,CAAC,CAAA,MAAO,CAAC;gBACpC,IAAI,IAAI,EAAE;gBACV,GAAG,IAAI,IAAI,EAAE;YACjB,CAAC;QAED,OAAO,SAAS,IAAI,CAAC;IACzB,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,SAAS,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC3E;AACJ"}}]
}