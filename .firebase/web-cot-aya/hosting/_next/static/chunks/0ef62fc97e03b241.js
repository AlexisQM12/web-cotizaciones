(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,67585,(e,t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"BailoutToCSR",{enumerable:!0,get:function(){return r}});let s=e.r(32061);function r({reason:e,children:t}){if("u"<typeof window)throw Object.defineProperty(new s.BailoutToCSRError(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return t}},9885,(e,t,i)=>{"use strict";function s(e){return e.split("/").map(e=>encodeURIComponent(e)).join("/")}Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"encodeURIPath",{enumerable:!0,get:function(){return s}})},52157,(e,t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"PreloadChunks",{enumerable:!0,get:function(){return l}});let s=e.r(43476),r=e.r(74080),o=e.r(63599),n=e.r(9885),a=e.r(43369);function l({moduleIds:e}){if("u">typeof window)return null;let t=o.workAsyncStorage.getStore();if(void 0===t)return null;let i=[];if(t.reactLoadableManifest&&e){let s=t.reactLoadableManifest;for(let t of e){if(!s[t])continue;let e=s[t].files;i.push(...e)}}if(0===i.length)return null;let l=(0,a.getDeploymentIdQueryOrEmptyString)();return(0,s.jsx)(s.Fragment,{children:i.map(e=>{let i=`${t.assetPrefix}/_next/${(0,n.encodeURIPath)(e)}${l}`;return e.endsWith(".css")?(0,s.jsx)("link",{precedence:"dynamic",href:i,rel:"stylesheet",as:"style",nonce:t.nonce},e):((0,r.preload)(i,{as:"script",fetchPriority:"low",nonce:t.nonce}),null)})})}},69093,(e,t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"default",{enumerable:!0,get:function(){return c}});let s=e.r(43476),r=e.r(71645),o=e.r(67585),n=e.r(52157);function a(e){return{default:e&&"default"in e?e.default:e}}let l={loader:()=>Promise.resolve(a(()=>null)),loading:null,ssr:!0},c=function(e){let t={...l,...e},i=(0,r.lazy)(()=>t.loader().then(a)),c=t.loading;function h(e){let a=c?(0,s.jsx)(c,{isLoading:!0,pastDelay:!0,error:null}):null,l=!t.ssr||!!t.loading,h=l?r.Suspense:r.Fragment,d=t.ssr?(0,s.jsxs)(s.Fragment,{children:["u"<typeof window?(0,s.jsx)(n.PreloadChunks,{moduleIds:t.modules}):null,(0,s.jsx)(i,{...e})]}):(0,s.jsx)(o.BailoutToCSR,{reason:"next/dynamic",children:(0,s.jsx)(i,{...e})});return(0,s.jsx)(h,{...l?{fallback:a}:{},children:d})}return h.displayName="LoadableComponent",h}},70703,(e,t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"default",{enumerable:!0,get:function(){return r}});let s=e.r(63141)._(e.r(69093));function r(e,t){let i={};"function"==typeof e&&(i.loader=e);let r={...i,...t};return(0,s.default)({...r,modules:r.loadableGenerated?.modules})}("function"==typeof i.default||"object"==typeof i.default&&null!==i.default)&&void 0===i.default.__esModule&&(Object.defineProperty(i.default,"__esModule",{value:!0}),Object.assign(i.default,i),t.exports=i.default)},54995,e=>{"use strict";let t,i,s,r;var o,n,a=e.i(43476),l=e.i(71645),c=e.i(18566),h=e.i(70703),d=e.i(74780),p=e.i(42554);let u=d.StyleSheet.create({page:{flexDirection:"column",backgroundColor:"#FFFFFF",padding:40,fontFamily:"Helvetica",fontSize:9,color:"#111"},headerContainer:{flexDirection:"row",justifyContent:"space-between",marginBottom:10},companyColumn:{width:"60%",flexDirection:"column",alignItems:"flex-start"},logo:{height:50,maxWidth:150,objectFit:"contain",objectPosition:"left",marginBottom:5},companyName:{fontSize:14,fontWeight:"bold",textTransform:"uppercase",color:"#333"},companyDetails:{fontSize:8,color:"#444",marginBottom:2},link:{color:"#007bff",textDecoration:"none"},quotationBox:{width:"40%",backgroundColor:"#f3f4f6",padding:0,alignItems:"center",justifyContent:"center"},quotationBoxInner:{width:"100%",paddingVertical:15,alignItems:"center"},rucText:{fontSize:10,fontWeight:"bold",marginBottom:5},docTitle:{fontSize:14,fontWeight:"bold",marginBottom:5},docNumber:{fontSize:12,fontWeight:"bold"},infoStrip:{flexDirection:"row",backgroundColor:"#f3f4f6",padding:4,marginBottom:10,borderTopWidth:2,borderTopColor:"#007acc",borderBottomWidth:1,borderBottomColor:"#ccc"},infoItem:{marginRight:40,flexDirection:"row"},infoLabel:{fontWeight:"bold",marginRight:5},sectionHeader:{fontSize:8,fontWeight:"bold",color:"#007acc",marginBottom:3,marginTop:6,textTransform:"uppercase"},clientContainer:{marginBottom:10,paddingBottom:5,borderBottomWidth:1,borderBottomColor:"#eee"},clientRow:{flexDirection:"row",marginBottom:3},clientLabel:{fontWeight:"bold",width:100},table:{width:"100%",marginTop:5},tableHeader:{flexDirection:"row",backgroundColor:"#f9fafb",borderBottomWidth:1,borderBottomColor:"#ccc",paddingVertical:6,paddingHorizontal:4},th:{fontWeight:"bold",fontSize:7,textTransform:"uppercase"},tableRow:{flexDirection:"row",borderBottomWidth:1,borderBottomColor:"#eee",paddingVertical:2,paddingHorizontal:4,minHeight:20,alignItems:"center"},colCode:{width:"8%"},colDesc:{width:"62%"},colQty:{width:"10%",textAlign:"center"},colPrice:{width:"10%",textAlign:"right"},colTotal:{width:"10%",textAlign:"right"},descContainer:{flexDirection:"row",alignItems:"flex-start"},itemImage:{width:30,height:30,marginRight:5,objectFit:"cover",borderRadius:2},itemTextContainer:{flex:1},itemTitle:{fontSize:8,marginBottom:2},itemDescText:{fontSize:7,color:"#555"},totalsContainer:{marginTop:10,alignSelf:"flex-end",width:"35%",paddingTop:5},totalRow:{flexDirection:"row",justifyContent:"space-between",paddingVertical:3},totalRowFinal:{flexDirection:"row",justifyContent:"space-between",paddingVertical:5,borderTopWidth:1,borderTopColor:"#000",marginTop:2},totalLabel:{fontWeight:"bold"},totalValue:{textAlign:"right"},totalAmountText:{fontSize:8,marginTop:5,textAlign:"right",fontStyle:"italic",width:"100%"},footerContainer:{marginTop:20,borderTopWidth:1,borderTopColor:"#ccc",paddingTop:10},notesText:{fontSize:7,lineHeight:1.4,textAlign:"justify",color:"#444"},paymentContainer:{marginTop:10,backgroundColor:"#f9fafb",padding:10,borderRadius:4},paymentRow:{flexDirection:"row",marginBottom:2},paymentLabel:{fontWeight:"bold",width:120,fontSize:7},paymentVal:{fontSize:7}}),f=({data:e})=>{let{clientName:t="",clientRuc:i="",clientAddress:s="",code:r="0000",items:o=[],company:n={},date:l=new Date().toLocaleDateString(),currency:c="Soles",notes:h="",serviceDescription:d=""}=e,f=o.reduce((e,t)=>e+parseFloat(t.price||0)*parseFloat(t.quantity||1),0),m=.18*f,y=f+m;return(0,a.jsx)(p.Document,{children:(0,a.jsxs)(p.Page,{size:"A4",style:u.page,children:[(0,a.jsxs)(p.View,{style:u.headerContainer,children:[(0,a.jsxs)(p.View,{style:u.companyColumn,children:[n.logoUrl&&(0,a.jsx)(p.Image,{src:n.logoUrl,style:u.logo}),(0,a.jsx)(p.Text,{style:u.companyName,children:n.name||"MI EMPRESA S.A.C."}),(0,a.jsx)(p.View,{style:{height:5}}),(0,a.jsx)(p.Text,{style:u.companyDetails,children:n.address||"Av. Principal 123, Lima, Perú"}),(0,a.jsxs)(p.Text,{style:u.companyDetails,children:["RUC: ",n.ruc||"20123456789"]}),(0,a.jsxs)(p.Text,{style:u.companyDetails,children:[n.email||"ventas@miempresa.com"," | ",n.phone||"999 888 777"]}),(0,a.jsx)(p.Text,{style:[u.companyDetails,u.link],children:n.website||"www.miempresa.com"})]}),(0,a.jsx)(p.View,{style:u.quotationBox,children:(0,a.jsxs)(p.View,{style:u.quotationBoxInner,children:[(0,a.jsxs)(p.Text,{style:u.rucText,children:["RUC ",n.ruc||"20000000001"]}),(0,a.jsx)(p.Text,{style:u.docTitle,children:"COTIZACIÓN"}),(0,a.jsx)(p.Text,{style:u.docNumber,children:r})]})})]}),(0,a.jsxs)(p.View,{style:u.infoStrip,children:[(0,a.jsxs)(p.View,{style:u.infoItem,children:[(0,a.jsx)(p.Text,{style:u.infoLabel,children:"FECHA EMISIÓN:"}),(0,a.jsx)(p.Text,{children:l})]}),(0,a.jsxs)(p.View,{style:u.infoItem,children:[(0,a.jsx)(p.Text,{style:u.infoLabel,children:"MONEDA:"}),(0,a.jsx)(p.Text,{children:c})]})]}),(0,a.jsx)(p.Text,{style:u.sectionHeader,children:"1. CLIENTE"}),(0,a.jsxs)(p.View,{style:u.clientContainer,children:[(0,a.jsxs)(p.View,{style:u.clientRow,children:[(0,a.jsx)(p.Text,{style:u.clientLabel,children:"Razón Social:"}),(0,a.jsx)(p.Text,{style:{flex:1},children:t})]}),i&&(0,a.jsxs)(p.View,{style:u.clientRow,children:[(0,a.jsx)(p.Text,{style:u.clientLabel,children:"RUC:"}),(0,a.jsx)(p.Text,{style:{flex:1},children:i})]}),s&&(0,a.jsxs)(p.View,{style:u.clientRow,children:[(0,a.jsx)(p.Text,{style:u.clientLabel,children:"Dirección:"}),(0,a.jsx)(p.Text,{style:{flex:1},children:s})]})]}),d&&(0,a.jsxs)(p.View,{style:{marginBottom:10},children:[(0,a.jsx)(p.Text,{style:u.sectionHeader,children:"2. DESCRIPCIÓN DEL SERVICIO O PRODUCTO"}),(0,a.jsx)(p.View,{style:{padding:10,border:"1px solid #eee",borderRadius:4},children:(0,a.jsx)(p.Text,{style:{fontSize:9,lineHeight:1.4,color:"#444"},children:d})})]}),(0,a.jsx)(p.Text,{style:u.sectionHeader,children:"3. DETALLES DEL PRESUPUESTO"}),(0,a.jsxs)(p.View,{style:u.table,children:[(0,a.jsxs)(p.View,{style:u.tableHeader,children:[(0,a.jsx)(p.Text,{style:[u.th,u.colCode],children:"ITEM"}),(0,a.jsx)(p.Text,{style:[u.th,u.colDesc],children:"DESCRIPCIÓN"}),(0,a.jsx)(p.Text,{style:[u.th,u.colQty],children:"CANT"}),(0,a.jsx)(p.Text,{style:[u.th,u.colPrice],children:"PRECIO.U"}),(0,a.jsx)(p.Text,{style:[u.th,u.colTotal],children:"SUBTOTAL"})]}),o.map((e,t)=>{let i=parseFloat(e.price||0),s=parseFloat(e.quantity||1),r=i*s;return(0,a.jsxs)(p.View,{style:u.tableRow,children:[(0,a.jsx)(p.Text,{style:[u.colCode,{fontSize:8}],children:t+1}),(0,a.jsx)(p.View,{style:u.colDesc,children:(0,a.jsxs)(p.View,{style:u.descContainer,children:[e.imageUrl&&(0,a.jsx)(p.Image,{src:e.imageUrl,style:u.itemImage}),(0,a.jsxs)(p.View,{style:u.itemTextContainer,children:[(0,a.jsx)(p.Text,{style:u.itemTitle,children:e.name||e.description}),e.details&&e.details!==(e.name||e.description)&&(0,a.jsx)(p.Text,{style:u.itemDescText,children:e.details})]})]})}),(0,a.jsx)(p.Text,{style:[u.colQty,{fontSize:8}],children:s.toFixed(2)}),(0,a.jsxs)(p.Text,{style:[u.colPrice,{fontSize:8}],children:["S/ ",i.toFixed(2)]}),(0,a.jsxs)(p.Text,{style:[u.colTotal,{fontSize:8}],children:["S/ ",r.toFixed(2)]})]},t)})]}),(0,a.jsxs)(p.View,{style:u.totalsContainer,children:[(0,a.jsxs)(p.View,{style:u.totalRow,children:[(0,a.jsx)(p.Text,{style:[u.totalLabel,{fontSize:8}],children:"Subtotal"}),(0,a.jsxs)(p.Text,{style:[u.totalValue,{fontSize:8}],children:["S/ ",f.toFixed(2)]})]}),(0,a.jsxs)(p.View,{style:u.totalRow,children:[(0,a.jsx)(p.Text,{style:[u.totalLabel,{fontSize:8}],children:"IGV (18%)"}),(0,a.jsxs)(p.Text,{style:[u.totalValue,{fontSize:8}],children:["S/ ",m.toFixed(2)]})]}),(0,a.jsxs)(p.View,{style:u.totalRowFinal,children:[(0,a.jsx)(p.Text,{style:[u.totalLabel,{fontSize:10}],children:"IMPORTE TOTAL"}),(0,a.jsxs)(p.Text,{style:[u.totalValue,{fontSize:10,fontWeight:"bold"}],children:["S/ ",y.toFixed(2)]})]})]}),(0,a.jsxs)(p.Text,{style:u.totalAmountText,children:["Importe en letras: SON ",function(e){if(0===e)return"CERO";let t=["","UN","DOS","TRES","CUATRO","CINCO","SEIS","SIETE","OCHO","NUEVE"],i=["DIEZ","ONCE","DOCE","TRECE","CATORCE","QUINCE","DIECISEIS","DIECISIETE","DIECIOCHO","DIECINUEVE"],s=["","","VEINTE","TREINTA","CUARENTA","CINCUENTA","SESENTA","SETENTA","OCHENTA","NOVENTA"],r=["","CIENTO","DOSCIENTOS","TRESCIENTOS","CUATROCIENTOS","QUINIENTOS","SEISCIENTOS","SETECIENTOS","OCHOCIENTOS","NOVECIENTOS"];function o(e){let o="";if(e>=100){if(100===e)return"CIEN";o+=r[Math.floor(e/100)]+" ",e%=100}return e>=20?20===e?o+="VEINTE":e>20&&e<30?o+="VEINTI"+t[e-20]:(o+=s[Math.floor(e/10)],e%10>0&&(o+=" Y "+t[e%10])):e>=10?o+=i[e-10]:e>0&&(o+=t[e]),o.trim()}if(1e3===e)return"MIL";if(1e6===e)return"UN MILLON";let n="";if(e>=1e6){let t=Math.floor(e/1e6);n+=(1===t?"UN MILLON":o(t)+" MILLONES")+" ",e%=1e6}if(e>=1e3){let t=Math.floor(e/1e3);n+=(1===t?"MIL":o(t)+" MIL")+" ",e%=1e3}return e>0&&(n+=o(e)),n.trim().toUpperCase()}(Math.floor(y))," CON ",Math.round(y%1*100),"/100 SOLES"]}),(0,a.jsx)(p.Text,{style:[u.sectionHeader,{marginTop:10}],children:"4. NOTAS"}),(0,a.jsx)(p.View,{style:{borderTopWidth:1,borderTopColor:"#eee",paddingTop:5},children:(0,a.jsx)(p.Text,{style:u.notesText,children:h})}),(0,a.jsx)(p.Text,{style:u.sectionHeader,children:"5. CONDICIONES DE PAGO"}),(0,a.jsx)(p.View,{style:u.paymentContainer,children:(0,a.jsxs)(p.View,{style:u.paymentRow,children:[(0,a.jsx)(p.Text,{style:u.paymentLabel,children:"CUENTAS BANCARIAS:"}),(0,a.jsx)(p.View,{style:{flex:1},children:n.accounts&&n.accounts.length>0?n.accounts.map((e,t)=>(0,a.jsxs)(p.View,{style:{marginBottom:4},children:[(0,a.jsxs)(p.Text,{style:[u.paymentVal,{fontWeight:"bold"}],children:[e.bankName," - Cuenta Corriente - Soles"]}),(0,a.jsxs)(p.Text,{style:u.paymentVal,children:["Nº: ",e.accountNumber]}),e.cci&&(0,a.jsxs)(p.Text,{style:u.paymentVal,children:["CCI: ",e.cci]})]},t)):(0,a.jsx)(p.Text,{style:u.paymentVal,children:"No hay cuentas configuradas."})})]})})]})})},m=Object.create(null);m.open="0",m.close="1",m.ping="2",m.pong="3",m.message="4",m.upgrade="5",m.noop="6";let y=Object.create(null);Object.keys(m).forEach(e=>{y[m[e]]=e});let g={type:"error",data:"parser error"},b="function"==typeof Blob||"u">typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),x="function"==typeof ArrayBuffer,_=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,v=({type:e,data:t},i,s)=>{if(b&&t instanceof Blob)if(i)return s(t);else return w(t,s);if(x&&(t instanceof ArrayBuffer||_(t)))if(i)return s(t);else return w(new Blob([t]),s);return s(m[e]+(t||""))},w=(e,t)=>{let i=new FileReader;return i.onload=function(){t("b"+(i.result.split(",")[1]||""))},i.readAsDataURL(e)};function C(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",j="u"<typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<T.length;e++)j[T.charCodeAt(e)]=e;let E="function"==typeof ArrayBuffer,k=(e,t)=>{if("string"!=typeof e)return{type:"message",data:R(e,t)};let i=e.charAt(0);return"b"===i?{type:"message",data:S(e.substring(1),t)}:y[i]?e.length>1?{type:y[i],data:e.substring(1)}:{type:y[i]}:g},S=(e,t)=>E?R((e=>{let t=.75*e.length,i=e.length,s,r=0,o,n,a,l;"="===e[e.length-1]&&(t--,"="===e[e.length-2]&&t--);let c=new ArrayBuffer(t),h=new Uint8Array(c);for(s=0;s<i;s+=4)o=j[e.charCodeAt(s)],n=j[e.charCodeAt(s+1)],a=j[e.charCodeAt(s+2)],l=j[e.charCodeAt(s+3)],h[r++]=o<<2|n>>4,h[r++]=(15&n)<<4|a>>2,h[r++]=(3&a)<<6|63&l;return c})(e),t):{base64:!0,data:e},R=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer;function O(e){return e.reduce((e,t)=>e+t.length,0)}function N(e,t){if(e[0].length===t)return e.shift();let i=new Uint8Array(t),s=0;for(let r=0;r<t;r++)i[r]=e[0][s++],s===e[0].length&&(e.shift(),s=0);return e.length&&s<e[0].length&&(e[0]=e[0].slice(s)),i}function A(e){if(e){var t=e;for(var i in A.prototype)t[i]=A.prototype[i];return t}}A.prototype.on=A.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},A.prototype.once=function(e,t){function i(){this.off(e,i),t.apply(this,arguments)}return i.fn=t,this.on(e,i),this},A.prototype.off=A.prototype.removeListener=A.prototype.removeAllListeners=A.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var i,s=this._callbacks["$"+e];if(!s)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r=0;r<s.length;r++)if((i=s[r])===t||i.fn===t){s.splice(r,1);break}return 0===s.length&&delete this._callbacks["$"+e],this},A.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=Array(arguments.length-1),i=this._callbacks["$"+e],s=1;s<arguments.length;s++)t[s-1]=arguments[s];if(i){i=i.slice(0);for(var s=0,r=i.length;s<r;++s)i[s].apply(this,t)}return this},A.prototype.emitReserved=A.prototype.emit,A.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},A.prototype.hasListeners=function(e){return!!this.listeners(e).length};let B="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),P="u">typeof self?self:"u">typeof window?window:Function("return this")();function I(e,...t){return t.reduce((t,i)=>(e.hasOwnProperty(i)&&(t[i]=e[i]),t),{})}let L=P.setTimeout,D=P.clearTimeout;function q(e,t){t.useNativeTimers?(e.setTimeoutFn=L.bind(P),e.clearTimeoutFn=D.bind(P)):(e.setTimeoutFn=P.setTimeout.bind(P),e.clearTimeoutFn=P.clearTimeout.bind(P))}function F(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}class U extends Error{constructor(e,t,i){super(e),this.description=t,this.context=i,this.type="TransportError"}}class V extends A{constructor(e){super(),this.writable=!1,q(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,i){return super.emitReserved("error",new U(e,t,i)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){let t=k(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){let e=this.opts.hostname;return -1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&443!==Number(this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){let t=function(e){let t="";for(let i in e)e.hasOwnProperty(i)&&(t.length&&(t+="&"),t+=encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t}(e);return t.length?"?"+t:""}}class z extends V{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";let t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let e=0;this._polling&&(e++,this.once("pollComplete",function(){--e||t()})),this.writable||(e++,this.once("drain",function(){--e||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){let t=e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)};((e,t)=>{let i=e.split("\x1e"),s=[];for(let e=0;e<i.length;e++){let r=k(i[e],t);if(s.push(r),"error"===r.type)break}return s})(e,this.socket.binaryType).forEach(t),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this._poll())}doClose(){let e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){var t;let i,s,r;this.writable=!1,t=e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})},s=Array(i=e.length),r=0,e.forEach((e,o)=>{v(e,!1,e=>{s[o]=e,++r===i&&t(s.join("\x1e"))})})}uri(){let e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=F()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}}let M=!1;try{M="u">typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}let W=M;function H(){}class $ extends z{constructor(e){if(super(e),"u">typeof location){const t="https:"===location.protocol;let i=location.port;i||(i=t?"443":"80"),this.xd="u">typeof location&&e.hostname!==location.hostname||i!==e.port}}doWrite(e,t){let i=this.request({method:"POST",data:e});i.on("success",t),i.on("error",(e,t)=>{this.onError("xhr post error",e,t)})}doPoll(){let e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e,t)=>{this.onError("xhr poll error",e,t)}),this.pollXhr=e}}class K extends A{constructor(e,t,i){super(),this.createRequest=e,q(this,i),this._opts=i,this._method=i.method||"GET",this._uri=t,this._data=void 0!==i.data?i.data:null,this._create()}_create(){var e;let t=I(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;let i=this._xhr=this.createRequest(t);try{i.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders)for(let e in i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0),this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(e)&&i.setRequestHeader(e,this._opts.extraHeaders[e])}catch(e){}if("POST"===this._method)try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{i.setRequestHeader("Accept","*/*")}catch(e){}null==(e=this._opts.cookieJar)||e.addCookies(i),"withCredentials"in i&&(i.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(i.timeout=this._opts.requestTimeout),i.onreadystatechange=()=>{var e;3===i.readyState&&(null==(e=this._opts.cookieJar)||e.parseCookies(i.getResponseHeader("set-cookie"))),4===i.readyState&&(200===i.status||1223===i.status?this._onLoad():this.setTimeoutFn(()=>{this._onError("number"==typeof i.status?i.status:0)},0))},i.send(this._data)}catch(e){this.setTimeoutFn(()=>{this._onError(e)},0);return}"u">typeof document&&(this._index=K.requestsCount++,K.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(void 0!==this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=H,e)try{this._xhr.abort()}catch(e){}"u">typeof document&&delete K.requests[this._index],this._xhr=null}}_onLoad(){let e=this._xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}function Y(){for(let e in K.requests)K.requests.hasOwnProperty(e)&&K.requests[e].abort()}K.requestsCount=0,K.requests={},"u">typeof document&&("function"==typeof attachEvent?attachEvent("onunload",Y):"function"==typeof addEventListener&&addEventListener("onpagehide"in P?"pagehide":"unload",Y,!1));let Q=(r=G({xdomain:!1}))&&null!==r.responseType;function G(e){let t=e.xdomain;try{if("u">typeof XMLHttpRequest&&(!t||W))return new XMLHttpRequest}catch(e){}if(!t)try{return new P[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(e){}}let J="u">typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class X extends V{get name(){return"websocket"}doOpen(){let e=this.uri(),t=this.opts.protocols,i=J?{}:I(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,i)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let i=e[t],s=t===e.length-1;v(i,this.supportsBinary,e=>{try{this.doWrite(i,e)}catch(e){}s&&B(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){let e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=F()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}let Z=P.WebSocket||P.MozWebSocket,ee={websocket:class extends X{createSocket(e,t,i){return J?new Z(e,t,i):t?new Z(e,t):new Z(e)}doWrite(e,t){this.ws.send(t)}},webtransport:class extends V{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{var s,r;let o,n,a,l,c=(s=Number.MAX_SAFE_INTEGER,r=this.socket.binaryType,i||(i=new TextDecoder),o=[],n=0,a=-1,l=!1,new TransformStream({transform(e,t){for(o.push(e);;){if(0===n){if(1>O(o))break;let e=N(o,1);l=(128&e[0])==128,n=(a=127&e[0])<126?3:126===a?1:2}else if(1===n){if(2>O(o))break;let e=N(o,2);a=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),n=3}else if(2===n){if(8>O(o))break;let e=N(o,8),i=new DataView(e.buffer,e.byteOffset,e.length),s=i.getUint32(0);if(s>2097151){t.enqueue(g);break}a=0x100000000*s+i.getUint32(4),n=3}else{if(O(o)<a)break;let e=N(o,a);t.enqueue(k(l?e:i.decode(e),r)),n=0}if(0===a||a>s){t.enqueue(g);break}}}})),h=e.readable.pipeThrough(c).getReader(),d=new TransformStream({transform(e,i){var s;s=t=>{let s,r=t.length;if(r<126)new DataView((s=new Uint8Array(1)).buffer).setUint8(0,r);else if(r<65536){let e=new DataView((s=new Uint8Array(3)).buffer);e.setUint8(0,126),e.setUint16(1,r)}else{let e=new DataView((s=new Uint8Array(9)).buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(r))}e.data&&"string"!=typeof e.data&&(s[0]|=128),i.enqueue(s),i.enqueue(t)},b&&e.data instanceof Blob?e.data.arrayBuffer().then(C).then(s):x&&(e.data instanceof ArrayBuffer||_(e.data))?s(C(e.data)):v(e,!1,e=>{t||(t=new TextEncoder),s(t.encode(e))})}});d.readable.pipeTo(e.writable),this._writer=d.writable.getWriter();let p=()=>{h.read().then(({done:e,value:t})=>{e||(this.onPacket(t),p())}).catch(e=>{})};p();let u={type:"open"};this.query.sid&&(u.data=`{"sid":"${this.query.sid}"}`),this._writer.write(u).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let i=e[t],s=t===e.length-1;this._writer.write(i).then(()=>{s&&B(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;null==(e=this._transport)||e.close()}},polling:class extends ${constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=Q&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new K(G,this.uri(),e)}}},et=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ei=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function es(e){var t,i;let s,r;if(e.length>8e3)throw"URI too long";let o=e,n=e.indexOf("["),a=e.indexOf("]");-1!=n&&-1!=a&&(e=e.substring(0,n)+e.substring(n,a).replace(/:/g,";")+e.substring(a,e.length));let l=et.exec(e||""),c={},h=14;for(;h--;)c[ei[h]]=l[h]||"";return -1!=n&&-1!=a&&(c.source=o,c.host=c.host.substring(1,c.host.length-1).replace(/;/g,":"),c.authority=c.authority.replace("[","").replace("]","").replace(/;/g,":"),c.ipv6uri=!0),s=(t=c.path).replace(/\/{2,9}/g,"/").split("/"),("/"==t.slice(0,1)||0===t.length)&&s.splice(0,1),"/"==t.slice(-1)&&s.splice(s.length-1,1),c.pathNames=s,i=c.query,r={},i.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,i){t&&(r[t]=i)}),c.queryKey=r,c}let er="function"==typeof addEventListener&&"function"==typeof removeEventListener,eo=[];er&&addEventListener("offline",()=>{eo.forEach(e=>e())},!1);class en extends A{constructor(e,t){if(super(),this.binaryType="arraybuffer",this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&"object"==typeof e&&(t=e,e=null),e){const i=es(e);t.hostname=i.host,t.secure="https"===i.protocol||"wss"===i.protocol,t.port=i.port,i.query&&(t.query=i.query)}else t.host&&(t.hostname=es(t.host).host);q(this,t),this.secure=null!=t.secure?t.secure:"u">typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("u">typeof location?location.hostname:"localhost"),this.port=t.port||("u">typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(e=>{let t=e.prototype.name;this.transports.push(t),this._transportsByName[t]=e}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},i=e.split("&");for(let e=0,s=i.length;e<s;e++){let s=i[e].split("=");t[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return t}(this.opts.query)),er&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},eo.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){let t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);let i=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](i)}_open(){if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);let e=this.opts.rememberUpgrade&&en.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";let t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",e=>this._onClose("transport close",e))}onOpen(){this.readyState="open",en.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":let t=Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);let e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){let i=this.writeBuffer[t].data;if(i&&(e+="string"==typeof i?function(e){let t=0,i=0;for(let s=0,r=e.length;s<r;s++)(t=e.charCodeAt(s))<128?i+=1:t<2048?i+=2:t<55296||t>=57344?i+=3:(s++,i+=4);return i}(i):Math.ceil(1.33*(i.byteLength||i.size))),t>0&&e>this._maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;let e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,B(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,i){return this._sendPacket("message",e,t,i),this}send(e,t,i){return this._sendPacket("message",e,t,i),this}_sendPacket(e,t,i,s){if("function"==typeof t&&(s=t,t=void 0),"function"==typeof i&&(s=i,i=null),"closing"===this.readyState||"closed"===this.readyState)return;(i=i||{}).compress=!1!==i.compress;let r={type:e,data:t,options:i};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),s&&this.once("flush",s),this.flush()}close(){let e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},i=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():e()}):this.upgrading?i():e()),this}_onError(e){if(en.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),er&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){let e=eo.indexOf(this._offlineEventListener);-1!==e&&eo.splice(e,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}en.protocol=4;class ea extends en{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),i=!1;en.priorWebsocketSuccess=!1;let s=()=>{i||(t.send([{type:"ping",data:"probe"}]),t.once("packet",e=>{if(!i)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;en.priorWebsocketSuccess="websocket"===t.name,this.transport.pause(()=>{i||"closed"!==this.readyState&&(c(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{let e=Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}}))};function r(){i||(i=!0,c(),t.close(),t=null)}let o=e=>{let i=Error("probe error: "+e);i.transport=t.name,r(),this.emitReserved("upgradeError",i)};function n(){o("transport closed")}function a(){o("socket closed")}function l(e){t&&e.name!==t.name&&r()}let c=()=>{t.removeListener("open",s),t.removeListener("error",o),t.removeListener("close",n),this.off("close",a),this.off("upgrading",l)};t.once("open",s),t.once("error",o),t.once("close",n),this.once("close",a),this.once("upgrading",l),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn(()=>{i||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){let t=[];for(let i=0;i<e.length;i++)~this.transports.indexOf(e[i])&&t.push(e[i]);return t}}class el extends ea{constructor(e,t={}){const i="object"==typeof e?e:t;(!i.transports||i.transports&&"string"==typeof i.transports[0])&&(i.transports=(i.transports||["polling","websocket","webtransport"]).map(e=>ee[e]).filter(e=>!!e)),super(e,i)}}el.protocol;let ec="function"==typeof ArrayBuffer,eh=Object.prototype.toString,ed="function"==typeof Blob||"u">typeof Blob&&"[object BlobConstructor]"===eh.call(Blob),ep="function"==typeof File||"u">typeof File&&"[object FileConstructor]"===eh.call(File);function eu(e){return ec&&(e instanceof ArrayBuffer||("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer))||ed&&e instanceof Blob||ep&&e instanceof File}let ef=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];(o=n||(n={}))[o.CONNECT=0]="CONNECT",o[o.DISCONNECT=1]="DISCONNECT",o[o.EVENT=2]="EVENT",o[o.ACK=3]="ACK",o[o.CONNECT_ERROR=4]="CONNECT_ERROR",o[o.BINARY_EVENT=5]="BINARY_EVENT",o[o.BINARY_ACK=6]="BINARY_ACK";class em{constructor(e){this.replacer=e}encode(e){return(e.type===n.EVENT||e.type===n.ACK)&&function e(t,i){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let i=0,s=t.length;i<s;i++)if(e(t[i]))return!0;return!1}if(eu(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1==arguments.length)return e(t.toJSON(),!0);for(let i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e(t[i]))return!0;return!1}(e)?this.encodeAsBinary({type:e.type===n.EVENT?n.BINARY_EVENT:n.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===n.BINARY_EVENT||e.type===n.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){let t,i,s=(t=[],i=e.data,e.data=function e(t,i){if(!t)return t;if(eu(t)){let e={_placeholder:!0,num:i.length};return i.push(t),e}if(Array.isArray(t)){let s=Array(t.length);for(let r=0;r<t.length;r++)s[r]=e(t[r],i);return s}if("object"==typeof t&&!(t instanceof Date)){let s={};for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=e(t[r],i));return s}return t}(i,t),e.attachments=t.length,{packet:e,buffers:t}),r=this.encodeAsString(s.packet),o=s.buffers;return o.unshift(r),o}}class ey extends A{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw Error("got plaintext data when reconstructing a packet");let i=(t=this.decodeString(e)).type===n.BINARY_EVENT;i||t.type===n.BINARY_ACK?(t.type=i?n.EVENT:n.ACK,this.reconstructor=new eg(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(eu(e)||e.base64)if(this.reconstructor)(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+e)}decodeString(e){let t=0,i={type:Number(e.charAt(0))};if(void 0===n[i.type])throw Error("unknown packet type "+i.type);if(i.type===n.BINARY_EVENT||i.type===n.BINARY_ACK){let s=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);let r=e.substring(s,t);if(r!=Number(r)||"-"!==e.charAt(t))throw Error("Illegal attachments");i.attachments=Number(r)}if("/"===e.charAt(t+1)){let s=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);i.nsp=e.substring(s,t)}else i.nsp="/";let s=e.charAt(t+1);if(""!==s&&Number(s)==s){let s=t+1;for(;++t;){let i=e.charAt(t);if(null==i||Number(i)!=i){--t;break}if(t===e.length)break}i.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){let s=this.tryParse(e.substr(t));if(ey.isPayloadValid(i.type,s))i.data=s;else throw Error("invalid payload")}return i}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case n.CONNECT:return ex(t);case n.DISCONNECT:return void 0===t;case n.CONNECT_ERROR:return"string"==typeof t||ex(t);case n.EVENT:case n.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===ef.indexOf(t[0]));case n.ACK:case n.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class eg{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t,i;let e=(t=this.reconPack,i=this.buffers,t.data=function e(t,i){if(!t)return t;if(t&&!0===t._placeholder){if("number"==typeof t.num&&t.num>=0&&t.num<i.length)return i[t.num];throw Error("illegal attachments")}if(Array.isArray(t))for(let s=0;s<t.length;s++)t[s]=e(t[s],i);else if("object"==typeof t)for(let s in t)Object.prototype.hasOwnProperty.call(t,s)&&(t[s]=e(t[s],i));return t}(t.data,i),delete t.attachments,t);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}let eb=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};function ex(e){return"[object Object]"===Object.prototype.toString.call(e)}function e_(e){var t;return"string"==typeof e.nsp&&(void 0===(t=e.id)||eb(t))&&function(e,t){switch(e){case n.CONNECT:return void 0===t||ex(t);case n.DISCONNECT:return void 0===t;case n.EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===ef.indexOf(t[0]));case n.ACK:return Array.isArray(t);case n.CONNECT_ERROR:return"string"==typeof t||ex(t);default:return!1}}(e.type,e.data)}function ev(e,t,i){return e.on(t,i),function(){e.off(t,i)}}e.s(["Decoder",()=>ey,"Encoder",()=>em,"PacketType",()=>n,"isPacketValid",()=>e_,"protocol",0,5],51890);let ew=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class eC extends A{constructor(e,t,i){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,i&&i.auth&&(this.auth=i.auth),this._opts=Object.assign({},i),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let e=this.io;this.subs=[ev(e,"open",this.onopen.bind(this)),ev(e,"packet",this.onpacket.bind(this)),ev(e,"error",this.onerror.bind(this)),ev(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var i,s,r;if(ew.hasOwnProperty(e))throw Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;let o={type:n.EVENT,data:t};if(o.options={},o.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){let e=this.ids++,i=t.pop();this._registerAckCallback(e,i),o.id=e}let a=null==(s=null==(i=this.io.engine)?void 0:i.transport)?void 0:s.writable,l=this.connected&&!(null==(r=this.io.engine)?void 0:r._hasPingExpired());return this.flags.volatile&&!a||(l?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,t){var i;let s=null!=(i=this.flags.timeout)?i:this._opts.ackTimeout;if(void 0===s){this.acks[e]=t;return}let r=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,Error("operation has timed out"))},s),o=(...e)=>{this.io.clearTimeoutFn(r),t.apply(this,e)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise((i,s)=>{let r=(e,t)=>e?s(e):i(t);r.withError=!0,t.push(r),this.emit(e,...t)})}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());let i={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((e,...s)=>(this._queue[0],null!==e?i.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)):(this._queue.shift(),t&&t(null,...s)),i.pending=!1,this._drainQueue())),this._queue.push(i),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||0===this._queue.length)return;let t=this._queue[0];(!t.pending||e)&&(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:n.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(t=>String(t.id)===e)){let t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case n.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case n.EVENT:case n.BINARY_EVENT:this.onevent(e);break;case n.ACK:case n.BINARY_ACK:this.onack(e);break;case n.DISCONNECT:this.ondisconnect();break;case n.CONNECT_ERROR:this.destroy();let t=Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){let t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length)for(let t of this._anyListeners.slice())t.apply(this,e);super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){let t=this,i=!1;return function(...s){i||(i=!0,t.packet({type:n.ACK,id:e,data:s}))}}onack(e){let t=this.acks[e.id];"function"==typeof t&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this._drainQueue(!0),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:n.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){let t=this._anyListeners;for(let i=0;i<t.length;i++)if(e===t[i]){t.splice(i,1);break}}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){let t=this._anyOutgoingListeners;for(let i=0;i<t.length;i++)if(e===t[i]){t.splice(i,1);break}}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length)for(let t of this._anyOutgoingListeners.slice())t.apply(this,e.data)}}var eT=e.i(51890);function ej(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}ej.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),i=Math.floor(t*this.jitter*e);e=(1&Math.floor(10*t))==0?e-i:e+i}return 0|Math.min(e,this.max)},ej.prototype.reset=function(){this.attempts=0},ej.prototype.setMin=function(e){this.ms=e},ej.prototype.setMax=function(e){this.max=e},ej.prototype.setJitter=function(e){this.jitter=e};class eE extends A{constructor(e,t){var i;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,q(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!=(i=t.randomizationFactor)?i:.5),this.backoff=new ej({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const s=t.parser||eT;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null==(t=this.backoff)||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null==(t=this.backoff)||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null==(t=this.backoff)||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new el(this.uri,this.opts);let t=this.engine,i=this;this._readyState="opening",this.skipReconnect=!1;let s=ev(t,"open",function(){i.onopen(),e&&e()}),r=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},o=ev(t,"error",r);if(!1!==this._timeout){let e=this._timeout,i=this.setTimeoutFn(()=>{s(),r(Error("timeout")),t.close()},e);this.opts.autoUnref&&i.unref(),this.subs.push(()=>{this.clearTimeoutFn(i)})}return this.subs.push(s),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let e=this.engine;this.subs.push(ev(e,"ping",this.onping.bind(this)),ev(e,"data",this.ondata.bind(this)),ev(e,"error",this.onerror.bind(this)),ev(e,"close",this.onclose.bind(this)),ev(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){B(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let i=this.nsps[e];return i?this._autoConnect&&!i.active&&i.connect():(i=new eC(this,e,t),this.nsps[e]=i),i}_destroy(e){for(let e of Object.keys(this.nsps))if(this.nsps[e].active)return;this._close()}_packet(e){let t=this.encoder.encode(e);for(let i=0;i<t.length;i++)this.engine.write(t[i],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var i;this.cleanup(),null==(i=this.engine)||i.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let t=this.backoff.duration();this._reconnecting=!0;let i=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open(t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()}))},t);this.opts.autoUnref&&i.unref(),this.subs.push(()=>{this.clearTimeoutFn(i)})}}onreconnect(){let e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}let ek={};function eS(e,t){let i;"object"==typeof e&&(t=e,e=void 0);let s=function(e,t="",i){let s=e;i=i||"u">typeof location&&location,null==e&&(e=i.protocol+"//"+i.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?i.protocol+e:i.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==i?i.protocol+"//"+e:"https://"+e),s=es(e)),!s.port&&(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";let r=-1!==s.host.indexOf(":")?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+r+":"+s.port+t,s.href=s.protocol+"://"+r+(i&&i.port===s.port?"":":"+s.port),s}(e,(t=t||{}).path||"/socket.io"),r=s.source,o=s.id,n=s.path,a=ek[o]&&n in ek[o].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||a?i=new eE(r,t):(ek[o]||(ek[o]=new eE(r,t)),i=ek[o]),s.query&&!t.query&&(t.query=s.queryKey),i.socket(s.path,t)}Object.assign(eS,{Manager:eE,Socket:eC,io:eS,connect:eS});var eR=e.i(73518);function eO({users:e,currentUser:t}){let[i,s]=(0,l.useState)(new Map),r=e?.filter(e=>e.uid!==t?.uid)||[];return 0===r.length?null:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",background:"#ffffff",borderRadius:"50px",border:"1px solid #f1f5f9",boxShadow:"0 1px 3px rgba(0,0,0,0.05)"},children:[(0,a.jsx)("span",{style:{fontSize:"0.75rem",color:"#667085",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Editando:"}),(0,a.jsx)("div",{style:{display:"flex",alignItems:"center",gap:"-0.5rem"},children:r.map((e,t)=>(0,a.jsx)("div",{style:{position:"relative",marginLeft:t>0?"-8px":"0"},title:e.firstName||e.email,children:e.photoURL?(0,a.jsx)("img",{src:e.photoURL,alt:e.firstName||"User",style:{width:"32px",height:"32px",borderRadius:"50%",border:"2px solid #ffffff",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"}}):(0,a.jsx)("div",{style:{width:"32px",height:"32px",borderRadius:"50%",border:"2px solid #ffffff",background:"#4f46e5",display:"flex",alignItems:"center",justifyContent:"center",color:"#ffffff",fontSize:"0.75rem",fontWeight:"600",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:(e.firstName||e.email||"?")[0].toUpperCase()})},e.uid||t))}),(0,a.jsx)("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",marginLeft:"0.5rem"},children:r.map((e,t)=>(0,a.jsxs)("span",{style:{fontSize:"0.75rem",color:"#101828",fontWeight:"500"},children:[e.firstName||e.email?.split("@")[0],t<r.length-1&&", "]},e.uid||t))})]})}var eN=e.i(88054),eA=e.i(51931);let eB=(0,h.default)(()=>e.A(57481).then(e=>e.PDFViewer),{loadableGenerated:{modules:[96898]},ssr:!1,loading:()=>(0,a.jsx)("p",{children:"Cargando previsualización..."})});function eP(){let e=(0,c.useParams)(),t=(0,c.useRouter)(),{id:i}=e,r=(s||(s=eS({path:"/socket.io",autoConnect:!1})),s),{user:o}=(0,eR.useAuth)(),[n,h]=(0,l.useState)({clientName:"",clientRuc:"",clientAddress:"",code:"",items:[{description:"Servicio Ejemplo",quantity:1,price:100}]}),[d,p]=(0,l.useState)(!1),[u,m]=(0,l.useState)([]),[y,g]=(0,l.useState)({}),b=(0,l.useRef)(!1);(0,l.useEffect)(()=>{if(o&&i)return r.connect(),r.emit("join_quotation",{quotationId:i,user:{uid:o.uid,firstName:o.firstName,photoURL:o.photoURL,email:o.email}}),fetch(`/api/quotations/${i}`).then(e=>e.json()).then(e=>{h({...e,clientName:e.clientName||"",clientRuc:e.clientRuc||"",clientAddress:e.clientAddress||"",items:e.items&&e.items.length>0?e.items:[{description:"",quantity:1,price:0}]})}),r.on("quotation_updated",e=>{console.log("Received update:",e),b.current=!0,h(t=>({...t,...e}))}),r.on("user_focus_change",({field:e,user:t,isFocused:i})=>{g(s=>{let r={...s};return i?r[e]=t:r[e]?.uid===t.uid&&delete r[e],r})}),r.on("users_in_quotation",e=>{console.log("Active users:",e),m(e)}),()=>{i&&r.emit("leave_quotation",i),r.off("quotation_updated"),r.off("user_focus_change"),r.off("users_in_quotation"),r.disconnect()}},[i,o]);let x=e=>{i&&o&&r.emit("user_focus",{quotationId:i,field:e,user:o})},_=e=>{i&&o&&r.emit("user_blur",{quotationId:i,field:e,user:o})},v=(e,t={})=>{let i=y[e];return i?{...t,borderColor:i.color||"#3b82f6",boxShadow:`0 0 0 2px ${i.color||"#3b82f6"}20`,transition:"all 0.2s",position:"relative"}:{...t,width:"100%",padding:"0.75rem",borderRadius:"6px",border:"1px solid #ccc"}},w=e=>{let t=y[e];return t?(0,a.jsx)("div",{style:{position:"absolute",top:"-18px",right:"0",background:t.color||"#3b82f6",color:"white",fontSize:"0.65rem",padding:"2px 6px",borderRadius:"4px 4px 0 0",zIndex:10},children:t.firstName}):null},C=(e,t)=>{h({...n,[e]:t}),i&&r.emit("update_quotation",{quotationId:i,[e]:t})},T=(e,t,s)=>{let o=[...n.items];o[e][t]=s,h({...n,items:o}),i&&r.emit("update_quotation",{quotationId:i,items:o})},j=async()=>{p(!0);try{await fetch(`/api/quotations/${i}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),p(!1)}catch(e){console.error(e),p(!1)}},E=n.items?n.items.reduce((e,t)=>e+t.quantity*t.price,0):0,k=n.companyProfiles?.find(e=>e.id===n.companyProfileId)||n.companyProfiles?.find(e=>e.isDefault)||{},S={...n,total:E,company:k,notes:void 0!==n.notes?n.notes:n.generalConditions?.text||""};return(0,a.jsxs)(eN.ProtectedRoute,{children:[(0,a.jsx)(eA.NavBar,{}),(0,a.jsxs)("div",{style:{display:"flex",height:"100vh",overflow:"hidden"},children:[(0,a.jsxs)("div",{style:{width:"50%",padding:"2rem",overflowY:"auto",borderRight:"1px solid #e2e8f0",backgroundColor:"#f8fafc"},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem"},children:[(0,a.jsx)("h1",{style:{color:"#1e293b"},children:"Editor de Cotización"}),(0,a.jsxs)("div",{style:{display:"flex",gap:"15px",alignItems:"center"},children:[(0,a.jsx)(eO,{users:u,currentUser:o}),(0,a.jsx)("button",{className:"btn",style:{background:"#64748b",color:"white"},onClick:()=>t.push("/"),children:"← Menú Principal"}),(0,a.jsxs)("span",{style:{fontSize:"0.8rem",color:"#22c55e",display:"flex",alignItems:"center",gap:"4px"},children:[(0,a.jsx)("span",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"#22c55e"}}),"Sincronizado"]}),(0,a.jsx)("button",{className:"btn btn-primary",onClick:j,disabled:d,children:d?"Guardando...":"Guardar Cambios"})]})]}),(0,a.jsxs)("div",{className:"card-editor",style:{marginBottom:"1.5rem",position:"relative"},children:[(0,a.jsx)("label",{style:{display:"block",fontWeight:"bold",marginBottom:"0.5rem",color:"#1e293b"},children:"Empresa Emisora"}),w("companyProfileId"),(0,a.jsxs)("select",{value:n.companyProfileId||"",onChange:e=>C("companyProfileId",parseInt(e.target.value)),onFocus:()=>x("companyProfileId"),onBlur:()=>_("companyProfileId"),style:v("companyProfileId"),children:[(0,a.jsx)("option",{value:"",children:"Seleccionar Empresa..."}),n.companyProfiles&&n.companyProfiles.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," ",e.isDefault?"(Predeterminada)":""]},e.id))]})]}),(0,a.jsxs)("div",{className:"card-editor",style:{marginBottom:"1.5rem",position:"relative"},children:[(0,a.jsx)("label",{style:{display:"block",fontWeight:"bold",marginBottom:"0.5rem",color:"#1e293b"},children:"Perfil de Cliente"}),w("clientProfileId"),(0,a.jsxs)("select",{value:n.clientProfileId||"",onChange:e=>{var t;let s,o;return t=e.target.value,s=n.clientProfiles?.find(e=>e.id===parseInt(t)),void(h(o={...n,clientProfileId:t?parseInt(t):null,clientName:s&&s.name||"",clientRuc:s&&s.ruc||"",clientAddress:s&&s.address||""}),i&&r.emit("update_quotation",{quotationId:i,clientProfileId:o.clientProfileId,clientName:o.clientName,clientRuc:o.clientRuc,clientAddress:o.clientAddress}))},onFocus:()=>x("clientProfileId"),onBlur:()=>_("clientProfileId"),style:v("clientProfileId"),children:[(0,a.jsx)("option",{value:"",children:"Seleccionar Cliente..."}),n.clientProfiles&&n.clientProfiles.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," ",e.isDefault?"(Predeterminado)":""]},e.id))]})]}),(0,a.jsx)("div",{className:"card-editor",style:{marginBottom:"2rem"},children:(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem"},children:[(0,a.jsxs)("div",{style:{position:"relative"},children:[(0,a.jsx)("label",{style:{display:"block",fontWeight:"bold",marginBottom:"0.5rem",color:"#1e293b"},children:"Nombre de Cliente"}),w("clientName"),(0,a.jsx)("input",{type:"text",value:n.clientName||"",onChange:e=>C("clientName",e.target.value),onFocus:()=>x("clientName"),onBlur:()=>_("clientName"),style:v("clientName"),placeholder:"Juan Pérez"})]}),(0,a.jsxs)("div",{style:{position:"relative"},children:[(0,a.jsx)("label",{style:{display:"block",fontWeight:"bold",marginBottom:"0.5rem",color:"#1e293b"},children:"RUC"}),w("clientRuc"),(0,a.jsx)("input",{type:"text",value:n.clientRuc||"",onChange:e=>C("clientRuc",e.target.value),onFocus:()=>x("clientRuc"),onBlur:()=>_("clientRuc"),style:v("clientRuc"),placeholder:"12345678901"})]}),(0,a.jsxs)("div",{style:{position:"relative"},children:[(0,a.jsx)("label",{style:{display:"block",fontWeight:"bold",marginBottom:"0.5rem",color:"#1e293b"},children:"Dirección"}),w("clientAddress"),(0,a.jsx)("input",{type:"text",value:n.clientAddress||"",onChange:e=>C("clientAddress",e.target.value),onFocus:()=>x("clientAddress"),onBlur:()=>_("clientAddress"),style:v("clientAddress"),placeholder:"Calle Falsa 123"})]}),(0,a.jsxs)("div",{style:{gridColumn:"span 3",marginTop:"1rem",position:"relative"},children:[(0,a.jsx)("label",{style:{display:"block",fontWeight:"bold",marginBottom:"0.5rem",color:"#1e293b"},children:"2. Descripción del Servicio o Producto"}),w("serviceDescription"),(0,a.jsx)("textarea",{value:n.serviceDescription||"",onChange:e=>C("serviceDescription",e.target.value),onFocus:()=>x("serviceDescription"),onBlur:()=>_("serviceDescription"),style:v("serviceDescription",{minHeight:"80px"}),placeholder:"Describa brevemente el servicio o producto a cotizar..."})]})]})}),(0,a.jsx)("h3",{style:{color:"#1e293b"},children:"Configuración Global de Precios (Interno)"}),(0,a.jsxs)("div",{className:"card-editor",style:{marginBottom:"2rem",backgroundColor:"#fff",border:"1px solid #e2e8f0"},children:[(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem",alignItems:"flex-end"},children:[(0,a.jsxs)("div",{style:{position:"relative"},children:[(0,a.jsx)("label",{style:{display:"block",fontSize:"0.8rem",fontWeight:"bold",marginBottom:"0.5rem",color:"#1e293b"},children:"% Ganancia Global"}),w("globalProfitPercentage"),(0,a.jsx)("input",{type:"number",value:n.globalProfitPercentage||"",onChange:e=>C("globalProfitPercentage",e.target.value),onFocus:()=>x("globalProfitPercentage"),onBlur:()=>_("globalProfitPercentage"),style:v("globalProfitPercentage"),placeholder:"0"})]}),(0,a.jsxs)("div",{style:{position:"relative"},children:[(0,a.jsx)("label",{style:{display:"block",fontSize:"0.8rem",fontWeight:"bold",marginBottom:"0.5rem",color:"#1e293b"},children:"% Otros Global"}),w("globalOtherCosts"),(0,a.jsx)("input",{type:"number",value:n.globalOtherCosts||"",onChange:e=>C("globalOtherCosts",e.target.value),onFocus:()=>x("globalOtherCosts"),onBlur:()=>_("globalOtherCosts"),style:v("globalOtherCosts"),placeholder:"0"})]}),(0,a.jsx)("button",{className:"btn",style:{background:"#334155",color:"white",padding:"0.75rem"},onClick:()=>{let e=parseFloat(n.globalProfitPercentage||0),t=parseFloat(n.globalOtherCosts||0);C("items",n.items.map(i=>{let s=parseFloat(i.basePrice||0);return{...i,profitPercentage:n.globalProfitPercentage,otherCosts:n.globalOtherCosts,price:(s*(1+(e+t)/100)).toFixed(2)}}))},children:"Aplicar a todos los ítems"})]}),(0,a.jsx)("p",{style:{fontSize:"0.7rem",color:"#64748b",marginTop:"0.75rem"},children:"* Esto actualizará los porcentajes y recalculará el Precio U. de cada ítem basado en su Costo Base."})]}),(0,a.jsx)("h3",{style:{color:"#1e293b"},children:"Ítems"}),n.items&&n.items.map((e,t)=>(0,a.jsx)("div",{className:"card-editor",style:{marginBottom:"1rem",padding:"1.25rem"},children:(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr",gap:"0.75rem",marginBottom:"0.75rem"},children:[(0,a.jsxs)("div",{style:{gridColumn:"span 5",position:"relative"},children:[w(`item_${t}_description`),(0,a.jsx)("input",{placeholder:"Descripción del ítem",style:v(`item_${t}_description`,{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"}),value:e.description,onChange:e=>T(t,"description",e.target.value),onFocus:()=>x(`item_${t}_description`),onBlur:()=>_(`item_${t}_description`)})]}),(0,a.jsxs)("div",{style:{position:"relative"},children:[(0,a.jsx)("label",{style:{fontSize:"0.7rem",color:"#334155",display:"block",fontWeight:"bold"},children:"Cant."}),w(`item_${t}_quantity`),(0,a.jsx)("input",{type:"number",style:v(`item_${t}_quantity`,{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"}),value:e.quantity,onChange:e=>T(t,"quantity",e.target.value),onFocus:()=>x(`item_${t}_quantity`),onBlur:()=>_(`item_${t}_quantity`)})]}),(0,a.jsxs)("div",{style:{position:"relative"},children:[(0,a.jsx)("label",{style:{fontSize:"0.7rem",color:"#334155",display:"block",fontWeight:"bold"},children:"Costo Base"}),w(`item_${t}_basePrice`),(0,a.jsx)("input",{type:"number",placeholder:"0.00",style:v(`item_${t}_basePrice`,{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"}),value:e.basePrice||"",onChange:i=>{let s=parseFloat(i.target.value)||0,r=parseFloat(e.profitPercentage)||0,o=parseFloat(e.otherCosts)||0;T(t,"basePrice",i.target.value),T(t,"price",(s*(1+(r+o)/100)).toFixed(2))},onFocus:()=>x(`item_${t}_basePrice`),onBlur:()=>_(`item_${t}_basePrice`)})]}),(0,a.jsxs)("div",{style:{position:"relative"},children:[(0,a.jsx)("label",{style:{fontSize:"0.7rem",color:"#334155",display:"block",fontWeight:"bold"},children:"% Gan."}),w(`item_${t}_profitPercentage`),(0,a.jsx)("input",{type:"number",placeholder:"0",style:v(`item_${t}_profitPercentage`,{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"}),value:e.profitPercentage||"",onChange:i=>{let s=parseFloat(i.target.value)||0,r=parseFloat(e.basePrice||0),o=parseFloat(e.otherCosts||0);T(t,"profitPercentage",i.target.value),T(t,"price",(r*(1+(s+o)/100)).toFixed(2))},onFocus:()=>x(`item_${t}_profitPercentage`),onBlur:()=>_(`item_${t}_profitPercentage`)})]}),(0,a.jsxs)("div",{style:{position:"relative"},children:[(0,a.jsx)("label",{style:{fontSize:"0.7rem",color:"#334155",display:"block",fontWeight:"bold"},children:"% Otros"}),w(`item_${t}_otherCosts`),(0,a.jsx)("input",{type:"number",placeholder:"0",style:v(`item_${t}_otherCosts`,{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"}),value:e.otherCosts||"",onChange:i=>{let s=parseFloat(e.profitPercentage||0),r=parseFloat(e.basePrice||0),o=parseFloat(i.target.value)||0;T(t,"otherCosts",i.target.value),T(t,"price",(r*(1+(s+o)/100)).toFixed(2))},onFocus:()=>x(`item_${t}_otherCosts`),onBlur:()=>_(`item_${t}_otherCosts`)})]}),(0,a.jsxs)("div",{style:{position:"relative"},children:[(0,a.jsx)("label",{style:{fontSize:"0.7rem",color:"#334155",display:"block",fontWeight:"bold"},children:"Precio U."}),w(`item_${t}_price`),(0,a.jsx)("input",{type:"number",step:"0.01",style:v(`item_${t}_price`,{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #22c55e",backgroundColor:"#f0fdf4"}),value:e.price,onChange:e=>T(t,"price",e.target.value),onFocus:()=>x(`item_${t}_price`),onBlur:()=>_(`item_${t}_price`)})]})]})},t)),(0,a.jsx)("button",{onClick:()=>{let e=[...n.items,{description:"",quantity:1,price:0}];h({...n,items:e}),i&&r.emit("update_quotation",{quotationId:i,items:e})},className:"btn",style:{background:"#e5e7eb",color:"#374151",marginBottom:"2rem"},children:"+ Agregar Ítem"}),(0,a.jsx)("h3",{style:{color:"#1e293b"},children:"Notas / Condiciones"}),(0,a.jsxs)("div",{className:"card-editor",style:{position:"relative"},children:[w("notes"),(0,a.jsx)("textarea",{value:void 0!==n.notes?n.notes:n.generalConditions?.text||"",onChange:e=>C("notes",e.target.value),onFocus:()=>x("notes"),onBlur:()=>_("notes"),rows:6,style:v("notes",{width:"100%",padding:"0.75rem",borderRadius:"6px",border:"1px solid #ccc",fontFamily:"inherit"}),placeholder:"Notas adicionales para esta cotización..."})]})]}),(0,a.jsx)("div",{style:{width:"50%",backgroundColor:"#525659",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,a.jsx)(eB,{width:"100%",height:"100%",style:{border:"none"},showToolbar:!0,children:(0,a.jsx)(f,{data:S})})})]})]})}e.s(["default",()=>eP],54995)}]);