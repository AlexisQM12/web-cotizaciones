{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/LENOVO/Documents/WEB%20DE%20cotizaciones/src/lib/firebase-admin.js"],"sourcesContent":["import admin from 'firebase-admin';\r\nimport dotenv from 'dotenv';\r\nimport { fileURLToPath } from 'url';\r\nimport { dirname, join } from 'path';\r\nimport fs from 'fs';\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = dirname(__filename);\r\nconst rootDir = join(__dirname, '../../');\r\nconst envPath = join(rootDir, '.env');\r\n\r\nconsole.log('--- FIREBASE DEBUG ---');\r\nconsole.log('Project Root:', rootDir);\r\nconsole.log('Dotenv Path:', envPath);\r\nif (fs.existsSync(envPath)) {\r\n    console.log('.env file exists at this path.');\r\n    const result = dotenv.config({ path: envPath });\r\n    if (result.error) console.error('Dotenv Error:', result.error);\r\n    else console.log('Dotenv loaded successfully.');\r\n} else {\r\n    console.error('.env file DOES NOT exist at expected path.');\r\n}\r\nconsole.log('Project ID in process.env:', process.env.FIREBASE_PROJECT_ID || 'MISSING');\r\nconsole.log('----------------------');\r\n\r\nlet firestore = null;\r\nlet storage = null;\r\n\r\n// Initialize Firebase Admin\r\nif (!admin.apps.length) {\r\n    try {\r\n        if (process.env.FIREBASE_PROJECT_ID) {\r\n            const projectId = process.env.FIREBASE_PROJECT_ID.trim().replace(/^[\"']|[\"']$/g, '');\r\n            const clientEmail = process.env.FIREBASE_CLIENT_EMAIL?.trim().replace(/^[\"']|[\"']$/g, '');\r\n\r\n            let privateKey = process.env.FIREBASE_PRIVATE_KEY || '';\r\n            privateKey = privateKey.trim().replace(/^[\"']|[\"']$/g, '').replace(/\\\\n/g, '\\n');\r\n\r\n            admin.initializeApp({\r\n                credential: admin.credential.cert({\r\n                    projectId,\r\n                    clientEmail,\r\n                    privateKey,\r\n                }),\r\n                storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET?.trim().replace(/^[\"']|[\"']$/g, '')\r\n            });\r\n            firestore = admin.firestore();\r\n            storage = admin.storage();\r\n            console.log('Firebase initialized successfully!');\r\n        } else {\r\n            console.warn('Firebase Admin SDK not initialized: Missing credentials.');\r\n        }\r\n    } catch (error) {\r\n        console.error('Firebase admin initialization error', error);\r\n    }\r\n}\r\n\r\nif (admin.apps.length > 0) {\r\n    firestore = admin.firestore();\r\n    storage = admin.storage();\r\n}\r\n\r\nexport { firestore, storage, admin };\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;AAEA,MAAM,aAAa,IAAA,gHAAa,EAAC,8BAAY,GAAG;AAChD,MAAM,YAAY,IAAA,4GAAO,EAAC;AAC1B,MAAM,UAAU,IAAA,yGAAI,EAAC,WAAW;AAChC,MAAM,UAAU,IAAA,yGAAI,EAAC,SAAS;AAE9B,QAAQ,GAAG,CAAC;AACZ,QAAQ,GAAG,CAAC,iBAAiB;AAC7B,QAAQ,GAAG,CAAC,gBAAgB;AAC5B,IAAI,wGAAE,CAAC,UAAU,CAAC,UAAU;IACxB,QAAQ,GAAG,CAAC;IACZ,MAAM,SAAS,kJAAM,CAAC,MAAM,CAAC;QAAE,MAAM;IAAQ;IAC7C,IAAI,OAAO,KAAK,EAAE,QAAQ,KAAK,CAAC,iBAAiB,OAAO,KAAK;SACxD,QAAQ,GAAG,CAAC;AACrB,OAAO;IACH,QAAQ,KAAK,CAAC;AAClB;AACA,QAAQ,GAAG,CAAC,8BAA8B,QAAQ,GAAG,CAAC,mBAAmB,IAAI;AAC7E,QAAQ,GAAG,CAAC;AAEZ,IAAI,YAAY;AAChB,IAAI,UAAU;AAEd,4BAA4B;AAC5B,IAAI,CAAC,8LAAK,CAAC,IAAI,CAAC,MAAM,EAAE;IACpB,IAAI;QACA,IAAI,QAAQ,GAAG,CAAC,mBAAmB,EAAE;YACjC,MAAM,YAAY,QAAQ,GAAG,CAAC,mBAAmB,CAAC,IAAI,GAAG,OAAO,CAAC,gBAAgB;YACjF,MAAM,cAAc,QAAQ,GAAG,CAAC,qBAAqB,EAAE,OAAO,QAAQ,gBAAgB;YAEtF,IAAI,aAAa,QAAQ,GAAG,CAAC,oBAAoB,IAAI;YACrD,aAAa,WAAW,IAAI,GAAG,OAAO,CAAC,gBAAgB,IAAI,OAAO,CAAC,QAAQ;YAE3E,8LAAK,CAAC,aAAa,CAAC;gBAChB,YAAY,8LAAK,CAAC,UAAU,CAAC,IAAI,CAAC;oBAC9B;oBACA;oBACA;gBACJ;gBACA,oFAAgE,OAAO,QAAQ,gBAAgB;YACnG;YACA,YAAY,8LAAK,CAAC,SAAS;YAC3B,UAAU,8LAAK,CAAC,OAAO;YACvB,QAAQ,GAAG,CAAC;QAChB,OAAO;YACH,QAAQ,IAAI,CAAC;QACjB;IACJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,uCAAuC;IACzD;AACJ;AAEA,IAAI,8LAAK,CAAC,IAAI,CAAC,MAAM,GAAG,GAAG;IACvB,YAAY,8LAAK,CAAC,SAAS;IAC3B,UAAU,8LAAK,CAAC,OAAO;AAC3B"}},
    {"offset": {"line": 141, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/LENOVO/Documents/WEB%20DE%20cotizaciones/src/app/api/quotations/route.js"],"sourcesContent":["import { firestore } from '@/lib/firebase-admin';\r\n\r\nexport async function GET(req) {\r\n    try {\r\n        const snapshot = await firestore.collection('quotations').get();\r\n\r\n        let quotations = snapshot.docs.map(doc => ({\r\n            id: doc.id,\r\n            ...doc.data()\r\n        }));\r\n\r\n        // Sort by updatedAt desc\r\n        quotations.sort((a, b) => new Date(b.updatedAt || 0) - new Date(a.updatedAt || 0));\r\n\r\n        return Response.json(quotations);\r\n    } catch (error) {\r\n        console.error('Quotations GET Error:', error);\r\n        return Response.json({\r\n            error: 'Failed to fetch quotations',\r\n            details: error.message,\r\n            stack: process.env.NODE_ENV === 'development' ? error.stack : undefined\r\n        }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function POST(req) {\r\n    try {\r\n        const { clientName } = await req.json();\r\n\r\n        // Generate professional code: COT-YYYY-NNNN\r\n        const currentYear = new Date().getFullYear();\r\n\r\n        // Query quotations from current year\r\n        const yearStart = new Date(currentYear, 0, 1).toISOString();\r\n        const yearEnd = new Date(currentYear, 11, 31, 23, 59, 59).toISOString();\r\n\r\n        const snapshot = await firestore.collection('quotations')\r\n            .where('createdAt', '>=', yearStart)\r\n            .where('createdAt', '<=', yearEnd)\r\n            .get();\r\n\r\n        // Count quotations in current year\r\n        const countThisYear = snapshot.size;\r\n        const nextNumber = countThisYear + 1;\r\n\r\n        // Format: COT-2026-0001\r\n        const code = `COT-${currentYear}-${String(nextNumber).padStart(4, '0')}`;\r\n\r\n        const newQuote = {\r\n            code,\r\n            clientName: clientName || 'Nuevo Cliente',\r\n            status: 'draft',\r\n            authorId: '1', // Dummy author id until auth is migrated\r\n            items: [],\r\n            total: 0,\r\n            createdAt: new Date().toISOString(),\r\n            updatedAt: new Date().toISOString()\r\n        };\r\n\r\n        const docRef = await firestore.collection('quotations').add(newQuote);\r\n\r\n        return Response.json({ id: docRef.id, ...newQuote });\r\n    } catch (error) {\r\n        console.error(error);\r\n        return Response.json({ error: 'Failed to create quotation' }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,eAAe,IAAI,GAAG;IACzB,IAAI;QACA,MAAM,WAAW,MAAM,8JAAS,CAAC,UAAU,CAAC,cAAc,GAAG;QAE7D,IAAI,aAAa,SAAS,IAAI,CAAC,GAAG,CAAC,CAAA,MAAO,CAAC;gBACvC,IAAI,IAAI,EAAE;gBACV,GAAG,IAAI,IAAI,EAAE;YACjB,CAAC;QAED,yBAAyB;QACzB,WAAW,IAAI,CAAC,CAAC,GAAG,IAAM,IAAI,KAAK,EAAE,SAAS,IAAI,KAAK,IAAI,KAAK,EAAE,SAAS,IAAI;QAE/E,OAAO,SAAS,IAAI,CAAC;IACzB,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,SAAS,IAAI,CAAC;YACjB,OAAO;YACP,SAAS,MAAM,OAAO;YACtB,OAAO,uCAAyC,MAAM,KAAK,GAAG;QAClE,GAAG;YAAE,QAAQ;QAAI;IACrB;AACJ;AAEO,eAAe,KAAK,GAAG;IAC1B,IAAI;QACA,MAAM,EAAE,UAAU,EAAE,GAAG,MAAM,IAAI,IAAI;QAErC,4CAA4C;QAC5C,MAAM,cAAc,IAAI,OAAO,WAAW;QAE1C,qCAAqC;QACrC,MAAM,YAAY,IAAI,KAAK,aAAa,GAAG,GAAG,WAAW;QACzD,MAAM,UAAU,IAAI,KAAK,aAAa,IAAI,IAAI,IAAI,IAAI,IAAI,WAAW;QAErE,MAAM,WAAW,MAAM,8JAAS,CAAC,UAAU,CAAC,cACvC,KAAK,CAAC,aAAa,MAAM,WACzB,KAAK,CAAC,aAAa,MAAM,SACzB,GAAG;QAER,mCAAmC;QACnC,MAAM,gBAAgB,SAAS,IAAI;QACnC,MAAM,aAAa,gBAAgB;QAEnC,wBAAwB;QACxB,MAAM,OAAO,CAAC,IAAI,EAAE,YAAY,CAAC,EAAE,OAAO,YAAY,QAAQ,CAAC,GAAG,MAAM;QAExE,MAAM,WAAW;YACb;YACA,YAAY,cAAc;YAC1B,QAAQ;YACR,UAAU;YACV,OAAO,EAAE;YACT,OAAO;YACP,WAAW,IAAI,OAAO,WAAW;YACjC,WAAW,IAAI,OAAO,WAAW;QACrC;QAEA,MAAM,SAAS,MAAM,8JAAS,CAAC,UAAU,CAAC,cAAc,GAAG,CAAC;QAE5D,OAAO,SAAS,IAAI,CAAC;YAAE,IAAI,OAAO,EAAE;YAAE,GAAG,QAAQ;QAAC;IACtD,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC;QACd,OAAO,SAAS,IAAI,CAAC;YAAE,OAAO;QAA6B,GAAG;YAAE,QAAQ;QAAI;IAChF;AACJ"}}]
}